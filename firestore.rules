rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Les utilisateurs peuvent lire leurs propres données et les concierges peuvent lire toutes les données utilisateur (pourrait être affiné)
    match /users/{userId} {
      allow read: if request.auth != null; // On pourrait restreindre à "if request.auth.uid == userId;" pour plus de sécurité
      allow write: if request.auth.uid == userId;
    }

    // Les concierges peuvent lire toutes les demandes
    // Les membres peuvent créer des demandes
    match /conciergeRequests/{requestId} {
       allow read: if request.auth != null; // Idéalement, restreindre aux concierges et au membre concerné
       allow create: if request.auth != null;
       allow update: if request.auth != null; // Idéalement, restreindre aux concierges
    }

    // Les utilisateurs ne peuvent lire que leurs propres transactions
    match /transactions/{transactionId} {
      allow read: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null; // Normalement géré par les fonctions backend
    }

    // Tout utilisateur connecté peut lire la liste des récompenses.
    match /rewards/{rewardId} {
      allow read: if request.auth != null;
    }

    // Les partenaires peuvent être lus par n'importe qui (ou seulement les utilisateurs connectés)
    match /partners/{partnerId} {
      allow read: if true; // Ou "if request.auth != null;" si réservé aux membres
    }
  }
}
